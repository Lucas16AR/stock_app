{% extends "base.html" %} 
{% block content %}
<h4>Editar producto</h4>
<form method="post" enctype="multipart/form-data">
  <div class="row">
    <div class="col-md-6">

      <div class="mb-3">
        <label for="nombre" class="form-label">Nombre</label>
        <input id="nombre" class="form-control" name="nombre" value="{{ producto.nombre }}" required>
      </div>

      <div class="mb-3">
        <label for="cantidad" class="form-label">Cantidad</label>
        <input id="cantidad" class="form-control" type="number" name="cantidad" value="{{ producto.cantidad }}" min="1" required>
      </div>

      <div class="mb-3">
        <label for="precio_compra" class="form-label">Precio compra</label>
        <input id="precio_compra" class="form-control" type="number" step="0.01" name="precio_compra" value="{{ producto.precio_compra }}" min="0" required>
      </div>

      <!-- ‚úÖ Checkboxes de categor√≠as -->
      <div class="mb-3">
        <label class="form-label">Categor√≠as</label>
        <div class="form-check">
          {% for cat in categorias %}
            <div class="form-check mb-1">
              <input class="form-check-input" type="checkbox" 
                     name="categorias" value="{{ cat.id }}" id="cat-{{ cat.id }}"
                     {% if cat.id in categorias_seleccionadas %}checked{% endif %}>
              <label class="form-check-label" for="cat-{{ cat.id }}">
                {{ cat.nombre }}
              </label>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- üîπ Selecci√≥n de lote -->
      <div class="mb-3">
        <label for="lote_id" class="form-label">Lote (opcional)</label>
        <select id="lote_id" class="form-select" name="lote_id">
          <option value="">-- Ninguno --</option>
          {% for lote in lotes %}
            <option value="{{ lote.id }}" {% if producto.lote_id == lote.id %}selected{% endif %}>
              Lote #{{ lote.id }} (env√≠o ${{ lote.costo_envio }})
            </option>
          {% endfor %}
        </select>
      </div>
    </div>

    <div class="col-md-6">
      <div class="mb-3">
        <label for="costo_envio_unitario" class="form-label">Costo env√≠o unitario</label>
        <input id="costo_envio_unitario" class="form-control" type="number" step="0.01" name="costo_envio_unitario" value="{{ producto.costo_envio_unitario }}" min="0">
      </div>

      <div class="mb-3">
        <label for="costo_extra" class="form-label">Costo extra</label>
        <input id="costo_extra" class="form-control" type="number" step="0.01" name="costo_extra" value="{{ producto.costo_extra }}" min="0">
      </div>

      <div class="mb-3">
        <label for="margen" class="form-label">Margen (0.5 = 50%)</label>
        <input id="margen" class="form-control" type="number" step="0.01" name="margen" value="{{ producto.margen }}" min="0">
      </div>

      <!-- üîπ Fotos actuales -->
      <div class="mb-3">
        <label class="form-label">Fotos actuales</label>
        <div class="d-flex flex-wrap">
          {% for foto in producto.fotos %}
            <div class="me-2 mb-2 text-center">
              <img src="{{ url_for('uploaded_file', filename=foto.ruta) }}" 
                   alt="Foto" style="height:100px; object-fit:cover; border:1px solid #ccc; border-radius:5px;">
              <form method="post" action="{{ url_for('eliminar_foto', foto_id=foto.id) }}" style="display:inline;">
                <button class="btn btn-sm btn-danger mt-1">Eliminar</button>
              </form>
            </div>
          {% endfor %}
        </div>
      </div>

      <!-- üîπ Subir nuevas fotos -->
      <div class="mb-3">
        <label for="fotos" class="form-label">Agregar nuevas fotos (m√°x 4)</label>
        <input id="fotos" class="form-control" type="file" name="fotos" multiple accept="image/*">
      </div>

      <div class="mt-3">
        <button class="btn btn-primary w-100">Guardar cambios</button>
      </div>
    </div>
  </div>
</form>
{% endblock %}