{% extends "base.html" %}
{% block content %}
<h4>Editar producto</h4>
<form method="post" enctype="multipart/form-data">
  <div class="row">
    <div class="col-md-6">
      <div class="mb-3"><label class="form-label">Nombre</label><input class="form-control" name="nombre" value="{{ producto.nombre }}" required></div>
      <div class="mb-3"><label class="form-label">Cantidad</label><input class="form-control" type="number" name="cantidad" value="{{ producto.cantidad }}" required></div>
      <div class="mb-3"><label class="form-label">Precio compra</label><input class="form-control" type="number" step="0.01" name="precio_compra" value="{{ producto.precio_compra }}" required></div>
      <div class="mb-3"><label class="form-label">Lote (opcional)</label>
        <select class="form-select" name="lote_id"><option value="">-- Ninguno --</option>{% for lote in lotes %}<option value="{{ lote.id }}" {% if producto.lote_id==lote.id %}selected{% endif %}>Lote #{{ lote.id }}</option>{% endfor %}</select></div>
      <div class="mb-3"><label class="form-label">Costo envío unitario</label><input class="form-control" type="number" step="0.01" name="costo_envio_unitario" value="{{ producto.costo_envio_unitario }}"></div>
      <div class="mb-3"><label class="form-label">Costo extra</label><input class="form-control" type="number" step="0.01" name="costo_extra" value="{{ producto.costo_extra }}"></div>
      <div class="mb-3"><label class="form-label">Margen</label><input class="form-control" type="number" step="0.01" name="margen" value="{{ producto.margen }}"></div>
    </div>
    <div class="col-md-6">
      <div class="mb-3"><label class="form-label">Agregar fotos (máx 4 en total)</label><input class="form-control" type="file" name="fotos" multiple accept="image/*"></div>
      <div class="mb-3">
        <label class="form-label">Fotos actuales</label>
        <div class="d-flex flex-wrap">
          {% for f in producto.fotos %}
            <div class="me-2 mb-2 text-center">
              <img src="{{ url_for('uploaded_file', filename=f.ruta) }}" style="width:120px; height:120px; object-fit:cover;" class="img-thumbnail">
              <form method="post" action="{{ url_for('eliminar_foto', foto_id=f.id) }}" onsubmit="return confirm('Eliminar foto?')">
                <button class="btn btn-sm btn-danger mt-1">Eliminar foto</button>
              </form>
            </div>
          {% endfor %}
        </div>
      </div>
      <div class="mt-3"><button class="btn btn-primary">Guardar cambios</button></div>
    </div>
  </div>
</form>
{% endblock %}